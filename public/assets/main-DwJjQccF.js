import{io as C}from"https://cdn.socket.io/4.7.5/socket.io.esm.min.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}})();const i=C();let l="";const h=document.getElementById("chat"),A=document.getElementById("formulario"),p=document.getElementById("mensaje"),g=[],m=document.getElementById("joinRoom"),f=document.getElementById("createRoom"),a=document.getElementById("messages-list"),c=document.getElementById("users-list-connected"),y=document.getElementById("title-room");let E=[],d="";function L(){if(d=prompt("Enter the room's name"),l=prompt("Enter your name"),d&&l){i.emit("create room",{room:d,socketId:i.id,name:l}),h.style.display="grid";const t=document.createElement("h2");t.innerText=`Room ${d}`,y.appendChild(t),f.toggleAttribute("disabled")}}function v(){l=prompt("Enter your name"),d=prompt("Enter room name"),l&&d&&i.emit("join",{room:d,name:l})}f.addEventListener("click",L);m.addEventListener("click",v);function b(){i.emit("leaving",l,d),console.log("disconnected"),h.style.display="none",m.textContent="Join Room",m.removeEventListener("click",b),f.removeAttribute("disabled"),m.addEventListener("click",v)}i.on("connect",()=>{console.log("user connected")});A.addEventListener("submit",t=>{t.preventDefault(),p.value&&(i.emit("sender message",{message:p.value,name:l,id:i.id,room:d,timeStamp:new Date().toLocaleString().slice(12,-3)}),p.value="")});i.on("joined room",(t,o)=>{if(i.connected&&l){h.style.display="grid",m.removeEventListener("click",v),m.textContent="Leave Room",m.addEventListener("click",b),y.innerHTML=`Welcome to room ${d}`;const s=[...t];for(;c.hasChildNodes();)c.removeChild(c.firstChild);s.map(r=>{let e=document.createElement("div"),n=document.createAttribute("id");n.value="user",e.setAttributeNode(n),e.innerHTML+=`${r.name}`,c.appendChild(e)}),E=[...s],console.log(`${o} has joined the room`)}});i.on("left room",t=>{let o=E.filter(s=>s.id!==t.id);for(console.log(`${t.name} has left the room`);c.hasChildNodes();)c.removeChild(c.firstChild);console.log(c),o.map(s=>{let r=document.createElement("div"),e=document.createAttribute("id");e.value="user",r.setAttributeNode(e),r.textContent+=`${s.name}`,c.appendChild(r)}),console.log(c)});i.on("sender message",t=>{g.push(t.message);let o=document.createElement("div"),s=document.createAttribute("id");s.value="message-send",o.setAttributeNode(s),o.textContent=t.message,a.appendChild(o),console.log(g),a.scrollTop=a.scrollHeight});i.on("recieved message",t=>{g.push(t.message);let o=document.createElement("div"),s=document.createElement("span"),r=document.createElement("span"),e=document.createElement("span");s.setAttribute("id","message"),r.setAttribute("id","name"),e.setAttribute("id","date"),e.textContent=t.timeStamp,s.textContent=t.message,r.textContent=t.name;let n=document.createAttribute("id");n.value="message-recieved",o.setAttributeNode(n),o.appendChild(e),o.appendChild(s),o.appendChild(r),a.appendChild(o),a.scrollTop=a.scrollHeight});i.on("disconnect",t=>{console.log(`${t} has disconnected`)});
